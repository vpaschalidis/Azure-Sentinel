id: 0c0ade34-2382-4a76-a428-db54aa30adae
name: Decoy User Account Authentication Attempt
description: |
   'This query detects authentication attempts from a decoy user account. The decoy user account is explicitly created and monitored to alert the SOC when it is used indicating a malicious activity.
   Ref: https://fidelissecurity.com/threatgeek/deception/best-deception-protection-for-active-directory'
severity: Medium
requiredDataConnectors:
  - connectorId: SecurityEvents
    dataTypes:
      - SecurityEvent
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - LateralMovement
relevantTechniques:
  - T1078
query: |
 // Enter a reference list of decoy users (usernames)
 let TargetUserNameList = dynamic (["DecoyUser1","DecoyUser2"]);
 SecurityEvent
    | where TargetUserName in (TargetUserNameList)
    | where EventID in (4624,4625)
    | summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated) by EventID, Computer, TargetUserName, TargetLogonId, LogonTypeName, IpAddress
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: TargetUserName
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: Computer
version: 1.0.0
kind: Scheduled
